{% extends 'global/base.html' %}

{% block content %}

<div class="form-container">
    <form method="post" class="form-1col">
        {% csrf_token %}
        {% include 'global/partials/_form_1col.html' %}
    </form>
</div>

<div class="scroll-tabela-bipagem">
    <table class="tabela-bipagem">
        <thead>
            <tr>
                <th>Numero da Caixa</th>
                <th>Serial</th>
                <th>Modelo</th>
                <th>Patrimonio</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for caixa in caixas %}
            <tr>
                <td>#{{ caixa.nr_caixa }}</td>
                <td>{{ serial }}</td>
                <td>{{ modelo }}</td>
                <td>{{ patrimonio }}</td>
                <td>
                    <a href="#" class="edit-icon" title="Editar caixa">
                        <i class="fa-solid fa-pen"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
  const serialInput = document.getElementById('serial-input');
  let buffer = '';
  let lastTime = Date.now();

  serialInput.addEventListener('keydown', (e) => {
    const now = Date.now();
    const timeDiff = now - lastTime;
    lastTime = now;

    if (timeDiff < 50) {
      if (e.key.length === 1) {
        buffer += e.key;
      }
    } else {
      buffer = e.key.length === 1 ? e.key : '';
    }

    if (e.key === 'Enter') {
      e.preventDefault();
      serialInput.value = buffer.trim();
      buffer = '';

      // Foca o próximo campo automaticamente
      focusNextField(serialInput);
    }

    // Bloqueia digitação manual
    if (e.key !== 'Enter') {
      e.preventDefault();
    }
  });

  ['paste', 'drop', 'contextmenu'].forEach(evt =>
    serialInput.addEventListener(evt, (e) => e.preventDefault())
  );

  // Função para focar o próximo input, textarea ou select visível e habilitado
  function focusNextField(currentField) {
    const focusables = Array.from(document.querySelectorAll('input:not([type="hidden"]):not([disabled]), textarea:not([disabled]), select:not([disabled])'));
    const index = focusables.indexOf(currentField);
    if (index !== -1 && index < focusables.length - 1) {
      focusables[index + 1].focus();
    }
  }
</script>




{% endblock %}